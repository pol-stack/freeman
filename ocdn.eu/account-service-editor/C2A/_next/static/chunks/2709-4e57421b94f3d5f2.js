"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2709],{62709:function(e,t,r){r.d(t,{m:function(){return _}});var a=r(35230),o=r.n(a),n=r(24246),s=r(27378),i=r(83573),l=r(75872),u=r(86677),c=r(15937),d=r(72154),p=r(50719),v=r(64932),f=r(79758),m=r(63768),E=r(50750),g=r(76612),b=r(20381),h=r(15575),O=r(51498),y=r(44175);function k(e,t,r,a,o,n,s){try{var i=e[n](s),l=i.value}catch(u){return void r(u)}i.done?t(l):Promise.resolve(l).then(a,o)}function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},a=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),a.forEach((function(t){w(e,t,r[t])}))}return e}var R={eventName:"user_logged_out",eventVersion:"1.0.0"},_=function(e){var t=e.isDev,r=e.locale,a=(0,b.m)().externalAuthProvider,w=(0,s.useState)(!!a),_=w[0],C=w[1],x=(0,s.useState)(null)[1],N=(0,s.useState)(!1)[1],Z=(0,i.Z)(),A=(0,u.useRouter)(),U=A.isReady,I=A.query,S=A.pathname,M=(0,s.useRef)(),V=(0,s.useContext)(c.Ni),D=V.optionalElements,F=V.optionalPages,L=null===F||void 0===F?void 0:F.oneStepLogin,P=I.app_id,H=I.client_id,q=I.state,j=I.scope,K=I.nonce,Q=I.redirect_uri,X=I.errorKind,B=(0,E.r)(),W=(0,g.h)(),G=W.email,J=W.setAccountType,z=W.setEmail,Y=W.setLoginData,$=(0,v.Z)("checkLoginIdentity",t,d.Z.SCORE),ee=(0,v.Z)("loginOneStep",t,d.Z.SCORE),te=(0,v.Z)("goToRegisterForm",t,d.Z.SCORE);(0,s.useEffect)((function(){U&&(G||C(!1))}),[U]),(0,s.useEffect)((function(){if(I.wasLoggedOut){var e,t,r,a,o,n,s=window;null===(e=s.webkit)||void 0===e||null===(t=e.messageHandlers)||void 0===t||null===(r=t.OKONTO)||void 0===r||null===(a=r.postMessage)||void 0===a||a.call(r,R),null===(o=s.OKONTO)||void 0===o||null===(n=o.postMessage)||void 0===n||n.call(o,JSON.stringify(R))}}),[I.wasLoggedOut]),(0,s.useEffect)((function(){X===f.qn.EXTERNAL_PROVIDER&&(0,l.Am)((0,n.jsx)(p.Z,{type:"error",message:Z.formatMessage(y.Z.EXTERNAL_PROVIDER_ERROR)}))}),[X]);var re=function(){var e,t=(e=o().mark((function e(t,s){var i,u,c,v,E,g,b,k,w,R,A,U,S,V,F,X,W,G,te,re,ae,oe,ne,se,ie,le,ue,ce,de,pe,ve,fe,me,Ee,ge,be;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.setErrors,u=s.resetForm,c=t.email,v=t.password,E=t.reCaptcha,g=t.group_order,_||L){e.next=64;break}if(e.prev=3,e.t0=h.Vr,e.t1=c,e.t2=H||P,e.t3=$.type,$.type!==d.Z.CHECKBOX){e.next=13;break}e.t4=E,e.next=16;break;case 13:return e.next=15,$.fetchToken();case 15:e.t4=e.sent;case 16:return e.t5=e.t4,e.t6={email:e.t1,client_id:e.t2,captcha_type:e.t3,captcha_response:e.t5},e.next=20,(0,e.t0)(e.t6).catch($.handleRequestError);case 20:k=e.sent,e.t7=null===k||void 0===k||null===(b=k.data)||void 0===b?void 0:b.code,e.next=e.t7===f.WH?24:e.t7===f.yp?30:e.t7===f.tx?36:43;break;case 24:return(0,m.l)({event:"kontoValidation",errorType:Z.formatMessage(y.Z.UNVERIFIED_ACCOUNT),errorHost:window.location.host}),i({password:Z.formatMessage(y.Z.UNVERIFIED_ACCOUNT),email:Z.formatMessage(y.Z.UNVERIFIED_ACCOUNT)}),J("TRIAL_ACCOUNT"),z(c),B("/confirm-account",{query:I,locale:r}),e.abrupt("return");case 30:return(0,m.l)({event:"kontoValidation",errorType:Z.formatMessage(y.Z.UNVERIFIED_ACCOUNT),errorHost:window.location.host}),i({password:Z.formatMessage(y.Z.UNVERIFIED_ACCOUNT),email:Z.formatMessage(y.Z.UNVERIFIED_ACCOUNT)}),J("TRIAL_REGISTRATION"),z(c),B("/confirm-account",{query:I,locale:r}),e.abrupt("return");case 36:if(z(c),D.displayAds){e.next=40;break}return B("/fill-password",{query:I,locale:r}),e.abrupt("return");case 40:return C(!0),$.reset(),e.abrupt("return");case 43:k&&((0,m.l)({event:"kontoValidation",errorType:Z.formatMessage(y.Z.USER_NOT_FOUND),errorHost:window.location.host}),i({email:Z.formatMessage(y.Z.USER_NOT_FOUND)})),e.next=62;break;case 46:if(e.prev=46,e.t8=e.catch(3),U=e.t8,S=null===U||void 0===U||null===(w=U.response)||void 0===w?void 0:w.status,V=(0,O.hV)("first",null===U||void 0===U||null===(R=U.response)||void 0===R||null===(A=R.data)||void 0===A?void 0:A.key),404!==S){e.next=56;break}return(0,m.l)({event:"kontoValidation",errorType:Z.formatMessage(y.Z.USER_NOT_FOUND),errorHost:window.location.host}),i({email:Z.formatMessage(y.Z.USER_NOT_FOUND)}),e.abrupt("return");case 56:if(F=V||((null===U||void 0===U?void 0:U.captcha)?f.QS.CAPTCHA:f.QS.DEFAULT),(0,m.l)({event:"kontoValidation",errorType:Z.formatMessage(y.Z[F]),errorHost:window.location.host}),!(null===U||void 0===U?void 0:U.captcha)&&V){e.next=61;break}return(0,l.Am)((0,n.jsx)(p.Z,{type:"error",message:Z.formatMessage(y.Z[F])})),e.abrupt("return");case 61:i({email:Z.formatMessage(y.Z[F])});case 62:e.next=128;break;case 64:if(W=v||(null===(X=M.current)||void 0===X?void 0:X.value)){e.next=69;break}return i({password:Z.formatMessage(y.Z.INVALID_PASSWORD)}),e.abrupt("return");case 69:if(e.prev=69,e.t9=O.ok,e.t10=H||P,e.t11=c,e.t12=W,e.t13=q,e.t14=j,e.t15=K,e.t16=Q,e.t17=g,e.t18=ee.type,ee.type!==d.Z.CHECKBOX){e.next=86;break}e.t19=E,e.next=89;break;case 86:return e.next=88,ee.fetchToken();case 88:e.t19=e.sent;case 89:return e.t20=e.t19,e.t21=!!a,e.t22=ee.handleRequestError,e.t23={clientId:e.t10,email:e.t11,password:e.t12,state:e.t13,scope:e.t14,nonce:e.t15,redirectUri:e.t16,groupOrder:e.t17,captchaType:e.t18,captchaResponse:e.t20,connectExternalProvider:e.t21,handleCaptchaRequestError:e.t22},e.next=95,(0,e.t9)(e.t23);case 95:if(!(te=e.sent).required2FA||!te.data){e.next=103;break}if(Y(T({},t,{password:W,twoFaMethod:{isTotpEnabled:!!(null===(re=te.data)||void 0===re?void 0:re.isTotpEnabled),isU2fEnabled:!!(null===(ae=te.data)||void 0===ae?void 0:ae.isU2fEnabled)}})),!(null===(oe=te.data)||void 0===oe?void 0:oe.is2faEnabled)||!(null===(ne=te.data)||void 0===ne?void 0:ne.isU2fEnabled)&&!(null===(se=te.data)||void 0===se?void 0:se.isTotpEnabled)){e.next=103;break}return B("/2fa",{query:I,locale:r}),e.abrupt("return");case 103:if(!(null===(G=te.data)||void 0===G?void 0:G.redirectUrl)){e.next=109;break}if(!a){e.next=108;break}return x(te.data.redirectUrl),N(!0),e.abrupt("return");case 108:window.location=te.data.redirectUrl;case 109:e.next=128;break;case 111:if(e.prev=111,e.t24=e.catch(69),ve=e.t24,fe=L?(0,O.hV)("one-step-login",null===ve||void 0===ve||null===(ie=ve.response)||void 0===ie||null===(le=ie.data)||void 0===le?void 0:le.key):(0,O.hV)("second",null===ve||void 0===ve||null===(ue=ve.response)||void 0===ue||null===(ce=ue.data)||void 0===ce?void 0:ce.key),me=null===ve||void 0===ve||null===(de=ve.response)||void 0===de||null===(pe=de.data)||void 0===pe?void 0:pe.code,Ee=(null===ve||void 0===ve?void 0:ve.captcha)?f.QS.CAPTCHA:f.QS.DEFAULT,!(null===ve||void 0===ve?void 0:ve.captcha)&&fe){e.next=124;break}return(0,m.l)({event:"kontoValidation",errorType:Z.formatMessage(y.Z[Ee]),errorHost:window.location.host}),(0,l.Am)((0,n.jsx)(p.Z,{type:"error",message:Z.formatMessage(y.Z[Ee])})),(null===ve||void 0===ve||null===(ge=ve.response)||void 0===ge?void 0:ge.status)===f.Fq&&(C(!1),u()),e.abrupt("return");case 124:be=fe,(0,m.l)({event:"kontoValidation",errorType:Z.formatMessage(y.Z[be]),errorHost:window.location.host}),L||i({password:Z.formatMessage(y.Z[be])}),L&&i({email:f.d9,password:Z.formatMessage(y.Z[me===f.iT?"INVALID_EMAIL_OR_PASSWORD":be])});case 128:case"end":return e.stop()}}),e,null,[[3,46],[69,111]])})),function(){var t=this,r=arguments;return new Promise((function(a,o){var n=e.apply(t,r);function s(e){k(n,a,o,s,i,"next",e)}function i(e){k(n,a,o,s,i,"throw",e)}s(void 0)}))});return function(e,r){return t.apply(this,arguments)}}();return{loginOneStepCaptcha:ee,passwordInputRef:M,pathname:S,onBackClick:function(){C(!1),$.reset()},formSubmit:re,isEmailExist:_,client_id:H,externalAuthProvider:a,checkLoginIdentityCaptcha:$,emailFromLoginContext:G,query:I,registerCaptcha:te}}}}]);